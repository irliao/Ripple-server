{"version":3,"sources":["src/api/service/pubnub.js"],"names":[],"mappings":"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","file":"src/api/service/pubnub.js","sourcesContent":["var CHALK = require('chalk');\nvar uuid = require('node-uuid');\nvar nconf = require('nconf');\nvar LOG = require('./util').logger;;\nvar PUBNUB = require('pubnub').init(\n    {\n        subscribe_key   : 'demo',//nconf.get('pubnub:subscribe_key'),\n        publish_key     : 'demo',//nconf.get('pubnub:publish_key'),\n        secret_key      : nconf.get('pubnub:secret_key'),\n        auth_key        : nconf.get('server-master-key'),\n        origin          : 'pubsub.pubnub.com',\n        ssl             : true,\n    });\n\nvar server_master_key = nconf.get('server-master-key');\n\nvar pnMessage =\n{\n    like: function(params)\n    {\n        return {\n\n            'type'              :   'update',\n            'code'              :   params['code'],\n            'explore_id'        :   params['explore_id'],\n            'chat_channel_id'   :   params['chat_channel_id'],\n\n        }\n    },\n    update:function(params){\n        return {\n\n            'type'              :   'update',\n            'code'              :   params['code'],\n            'explore_id'        :   params['explore_id'],\n            'chat_channel_id'   :   params['chat_channel_id'],\n\n        }\n    },\n    subscription:function(params){\n        return {\n            'type':         '001',\n            'uuid' :  params.uuid || '',\n            'image_url'  :    params.image_url || '',\n            'status'    :   params.status || '',\n        }\n    }\n\n}\n\n/*\n*   Notify a client\n*/\nexports.notifyRemote = function( params)\n{\n    LOG.info(pnMessage[ params['type'] ]( params ));\n    PUBNUB.publish(\n        {\n            channel   : params['server_channel_id'],\n            //auth_key  : server_master_key,\n            message   : pnMessage[ params['type'] ]( params ),\n            callback  : function(e) { LOG.info( \"SUCCESS!\", e ); },\n            error     : function(e) { LOG.info( \"FAILED! RETRY PUBLISH!\", e ); }\n        });\n}\n\n\nexports.createServerConnection = function( device_id, server_auth_key, next )\n{\n    var client_auth_key = server_auth_key;\n    /*\n    PUBNUB.grant(\n        {\n            channel     : device_id,\n            auth_key    : client_auth_key,\n            read        : true,\n            callback    : function(e) { LOG.info( 'SUCCESS!', e ); },\n            error       : function(e) { LOG.info( 'FAILED! RETRY PUBLISH!', e ); }\n        });\n*/\n/*\n    PUBNUB.grant(\n        {\n            channel     : device_id,\n            //auth_key    : server_master_key,\n            read        : true,\n            write       : true,\n            callback    : function(e) { LOG.info( 'SUCCESS!', e ); },\n            error       : function(e) { LOG.info( 'FAILED! RETRY PUBLISH!', e ); }\n        });\n*/\n    next(client_auth_key);\n}\n\nexports.createConversation = function( initator_auth_key, target_auth_key, next)\n{\n    var channel_id = uuid.v4();\n\n        PUBNUB.grant(\n            {\n                channel     : channel_id,\n                auth_key    : initator_auth_key,\n                read        : true,\n                write       : true,\n                callback    : function(e) { LOG.info( 'SUCCESS!', e ); },\n                error       : function(e) { LOG.info( 'FAILED! RETRY PUBLISH!', e ); }\n            });\n\n        PUBNUB.grant(\n            {\n                channel     : channel_id,\n                auth_key    : target_auth_key,\n                read        : true,\n                write       : true,\n                callback    : function(e) { LOG.info( 'SUCCESS!', e ); },\n                error       : function(e) { LOG.info( 'FAILED! RETRY PUBLISH!', e ); }\n            });\n\n        next(channel_id);\n\n\n\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar psAction =\n{\n    subTest : function(channel, message, cb )\n    {\n    /* ---------------------------------------------------------------------------\n    Listen for Messages\n    --------------------------------------------------------------------------- */\n    LOG.info(' heree '+channel);\n    var delivery_count = 0;\n    var err_count = 0;\n    PUBNUB.subscribe({\n        channel  : channel,\n        connect  : function() {\n\n            LOG.info('connected');\n\n            // Publish a Message on Connect\n            PUBNUB.publish({\n\n                channel  : channel,\n                auth_key : 'key',\n                message  : {\n                    count    : ++delivery_count,\n                    some_key : 'Hello World!',\n                    message    : message\n                },\n                error : function(info){\n                    LOG.info(info);\n                },\n                callback : function(info){\n                    if (!info[0]) LOG.info('Failed Message Delivery')\n\n                    LOG.info(info);\n\n                    PUBNUB.history({\n                        channel  : channel,\n                        limit    : 1,\n                        callback : function(messages){\n                            // messages is an array of history.\n                            LOG.info(messages);\n                        }\n                    });\n                }\n            });\n        },\n        callback : function(message) {\n            LOG.info(message);\n            LOG.info('MESSAGE RECEIVED!!!');\n        },\n        error    : function() {\n            err_count+=1;\n            LOG.info('PUBNUB Connection Dropped');\n        }\n    });\n    cb();\n    }\n}\n\n\n\n\nexports.subTest = function( channel_id, message, cb )\n{\n        psAction.subTest( channel_id, message, cb );\n}\n\nexports.subscribe_server = function( params, cb )\n{\n        LOG.info( CHALK.blue( 'Subscribing to server: '+ params['mid'] ) );\n        PUBNUB.publish(\n        {\n            channel   : params['mid'],\n            message   : { 'message':'Hello' },\n            callback  : function(m) { LOG.info( 'SUCCESS!', m ); },\n            error     : function(e) { LOG.info( 'FAILED! RETRY PUBLISH!', e ); }\n        });\n}\nexports.grant = function( channel, cb )\n{\n\n        PUBNUB.grant({\n           channel : channel,\n           auth_key : 'nope',\n           read    : true,\n           write    : true,\n           ttl      : 300,\n           callback  : function(m) { cb(  'SUCCESS!',m ); },\n            error     : function(e) { cb( 'FAILED! RETRY PUBLISH!'+ e ); }\n         });\n\n}\n\n\nexports.fivefrds = function( channel, next )\n{\n\n\n    var deny1 = channel+'_'+'d1';\n    var deny2 = channel+'_'+'d2';\n    var allow1 = channel+'_'+'a1';\n    var allow2 = channel+'_'+'a2';\n    var allow3 = channel+'_'+'a3';\n    console.log(channel);\n\n        PUBNUB.grant({\n           channel : deny1,\n           auth_key : \"nope\",\n           read    : true,\n           write    : true,\n           ttl      : 3000,\n           callback  : function(m) { LOG.info(  'SUCCESS!',m ); },\n            error     : function(e) { LOG.info( 'FAILED! RETRY PUBLISH!'+ e ); }\n         });\n        PUBNUB.grant({\n           channel : allow1,\n           auth_key : \"key\",\n           read    : true,\n           write    : true,\n           ttl      : 3000,\n           callback  : function(m) { LOG.info(  'SUCCESS!',m ); },\n            error     : function(e) { LOG.info( 'FAILED! RETRY PUBLISH!'+ e ); }\n         });\n        PUBNUB.grant({\n           channel : deny2,\n           auth_key : \"nope\",\n           read    : true,\n           write    : true,\n           ttl      : 3000,\n           callback  : function(m) { LOG.info(  'SUCCESS!',m ); },\n            error     : function(e) { LOG.info( 'FAILED! RETRY PUBLISH!'+ e ); }\n         });\n        PUBNUB.grant({\n           channel : allow2,\n           auth_key : \"key\",\n           read    : true,\n           write    : true,\n           ttl      : 3000,\n           callback  : function(m) { LOG.info(  'SUCCESS!',m ); },\n            error     : function(e) { LOG.info( 'FAILED! RETRY PUBLISH!'+ e ); }\n         });\n        PUBNUB.grant({\n           channel : allow3,\n           auth_key : \"key\",\n           read    : true,\n           write    : true,\n           ttl      : 3000,\n           callback  : function(m) { LOG.info(  'SUCCESS!',m ); },\n            error     : function(e) { LOG.info( 'FAILED! RETRY PUBLISH!'+ e ); }\n         });\n        next(\"key\", deny1,deny2,allow1,allow2,allow3);\n}\nexports.group = function( params, next )\n{\n\n    var auth_key = uuid.v4();\n    var allow = uuid.v4();\n    var deny = uuid.v4();\n    for(var i=0;i<10;i++){\n        console.log(i);\n        var name = 'grouptest-'+i;\n        console.log(name);\n        PUBNUB.grant({\n           channel : name,\n           auth_key : 'nope',\n           read    : (i==3 || i==4)?false:true,\n           write    : true,\n           ttl      : 3000,\n           callback  : function(m) { LOG.info(  'SUCCESS! ',m ); },\n            error     : function(e) { LOG.info( 'FAILED! RETRY PUBLISH!'+ e ); }\n         });\n    }\n\n\n    next(auth_key, allow, deny);\n}\nexports.pub = function( channel, message, cb )\n{\n        LOG.info(' heree');\n        LOG.info( CHALK.blue( 'pub to server: '+ channel ) );\n\n        PUBNUB.publish(\n        {\n            channel   : channel,\n            message   : { 'message':'Hello from glimpse server~~~' },\n            callback  : function(e) { LOG.info( 'SUCCESS!', e ); cb(); },\n            error     : function(e) { LOG.info( 'FAILED! RETRY PUBLISH!', e ); }\n        });\n\n}\n\n\n"]}