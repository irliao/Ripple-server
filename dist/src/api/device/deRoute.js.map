{"version":3,"sources":["src/api/device/deRoute.js"],"names":[],"mappings":"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","file":"src/api/device/deRoute.js","sourcesContent":["var DeviceCtr     = require('./deControl');\nvar DEVICE    = require('../device/deModel');\nvar AUTH     = require('../service/auth');\nvar routeValidator     = require('../service/util').validator.route;\nvar auth_tokenValidator     = require('../service/util').validator.auth_token;\nvar nconf = require('nconf');\n\nvar express = require('express');\nvar device = express.Router();\n\n/*\n**  Middleware\n**\n*/\ndevice.use(routeValidator('device','all'));\n\n\n\n/*\n**  Routes\n**\n*/\ndevice.route('/')\n\n   /*\n    *   Request when APP is open\n    */\n    .post( AUTH.registerOrAuth,function( req, res )\n    {\n        var params =\n        {\n            auth_token:req.body.auth_token\n        };\n        var response = function( token, require_login, uuid, pubnub_key, friend_list, status )\n        {\n            res.status(status).json(\n                {\n                    auth_token: token,\n                    relogin:require_login,\n                    pubnub_key:pubnub_key,\n                    uuid: uuid,\n                    friend_list: friend_list\n                });\n        };\n\n        if(params.auth_token === 'new')// For now, all clients requesting token will be granted\n        {\n            DeviceCtr.register( params, res, response);\n        }\n        else\n        {\n            auth_tokenValidator(req,res,function()\n                {\n                    DeviceCtr.login(params, res, response );\n                });\n        }\n    });\n\ndevice.use(AUTH.authenticate);\ndevice.route('/info')\n    .all(DEVICE.getDevice)\n    .post(function(req, res){\n        res.json(req.body.resource_device)\n    });\n\ndevice.route('/friend')\n    .all(DEVICE.getDevice)\n    .post( function( req, res)\n    {\n\n        var params =\n        {\n            resource_device:req.body.resource_device,\n            auth_tokne:req.body.auth_tokne\n        };\n\n        var response = function( err, friends )\n        {\n            res.json(\n                {\n                    friends: friends\n                });\n        };\n\n        DeviceCtr.getFriends( params, response);\n    });\n\ndevice.route('/friend/delete')\n    .post( function( req, res )\n    {\n        var params =\n        {\n            my_device_id : req.body.device_id,\n            target_mid :  req.body.target_id\n        };\n        DeviceCtr.unFriend( params,\n            function( err, status )\n            {\n                res.json(\n                    {\n                        status: status\n                    });\n            })\n\n    });\n\ndevice.route('/friend/add')\n    .post( function( req, res )\n    {\n        var params =\n        {\n            my_device_id : req.body.device_id,\n            target_mid :  req.body.target_id\n        };\n        //@@@ add friend using alternative methonds, ex QR\n\n    });\n\n\ndevice.route('/explore/:page')\n    /*\n    *   Get pagination on explore list\n    */\n    .post( function( req, res )\n    {\n        var params =\n        {\n            my_device_id :req.body.device_id,\n            skip : 10*req.params.page,\n            offset : 10\n        };\n\n        DeviceCtr.getPageExplore( params,\n            function( err, explore_list )\n            {\n                console.log(explore_list);\n                res.json(\n                    {\n                        explore: explore_list\n                    });\n            });\n    });\n\n\nmodule.exports = device"]}